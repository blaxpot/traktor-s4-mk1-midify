# traktor-s4-mk1-midify

Translate events from a Traktor S4 mk1 DJ controller generated by the linux `snd-usb-caiaq` kernel module to MIDI signals which can be used by [Mixxx](https://mixxx.org/download/) (virtual DJ software).

## Setup
1. Check that you have the `snd-usb-caiaq` kernel module enabled:
    ```bash
    # lsmod | grep snd_usb_caiaq
    snd_usb_caiaq          57344  0
    snd_rawmidi            36864  3 snd_seq_midi,snd_usbmidi_lib,snd_usb_caiaq
    snd_pcm               106496  14 snd_hda_codec_hdmi,snd_hda_intel,snd_usb_audio,snd_hda_codec,snd_sof,snd_sof_intel_hda_common,snd_soc_core,snd_hda_core,snd_usb_caiaq,snd_pcm_dmaengine
    snd                    90112  33 snd_hda_codec_generic,snd_seq,snd_seq_device,snd_hda_codec_hdmi,snd_hwdep,snd_hda_intel,snd_usb_audio,snd_usbmidi_lib,snd_hda_codec,snd_hda_codec_realtek,snd_timer,snd_compress,thinkpad_acpi,snd_soc_core,snd_pcm,snd_usb_caiaq,snd_rawmidi
    ```
2. Check that you have `amixer`/`aplay` - on Ubuntu they're in the `alsa-utils` package:
    ```bash
    # amixer controls
    numid=43,iface=CARD,name='HDMI/DP,pcm=10 Jack'
    numid=19,iface=CARD,name='HDMI/DP,pcm=3 Jack'
    numid=25,iface=CARD,name='HDMI/DP,pcm=7 Jack'
    ...
    # aplay -l |grep Traktor
    card 1: TraktorKontrolS [Traktor Kontrol S4], device 0: Traktor Kontrol S4 [Traktor Kontrol S4]
    ```
3. Install this package using `pip install .` in the project root dir ([Python 3](https://www.python.org/downloads/) / [pip](https://pypi.org/project/pip/#files) required)
4. Run `traktor-s4-mk1-midify` and select the appropriate input device:
    ```bash
    # traktor-s4-mk1-midify
    List of your devices:
    [0]     /dev/input/event16      Traktor Kontrol S4      usb-0000:00:14.0-4/input0
    ...
    Which of these is the controller? 0
    ```
5. Launch [Mixxx](https://mixxx.org/download/) and configure it to use the MIDI device named `traktor-s4-mk1-midify`

# Notes
* LEDs are controlled by shelling out to ALSA. See the output below for an idea of what can be controlled this way. (Note: the controller seems to need to be communicating with Mixxx and/or this program to work properly):
     ```bash
     # amixer -c TraktorKontrolS controls |grep -i sync
     numid=79,iface=HWDEP,name='LED: Deck A: Sync'
     numid=123,iface=HWDEP,name='LED: Deck B: Sync'

     [13] blaxpot@whydah-navi ~
     # amixer -c TraktorKontrolS cset numid=79 31
     numid=79,iface=HWDEP,name='LED: Deck A: Sync'
       ; type=INTEGER,access=rw------,values=1,min=0,max=31,step=0
       : values=31
     ```
* Get debug logs from Mixxx: `mixxx --controllerDebug --developer`
* Configure inputs / outputs properly in `~/.asoundrc`:
    ```
    pcm.TraktorS4InputCOutputMain { type plug; slave.pcm "hw:TraktorKontrolS,0,0"; }
    pcm.TraktorS4InputDOutputHeadphones { type plug; slave.pcm "hw:TraktorKontrolS,0,1"; }
    ```
